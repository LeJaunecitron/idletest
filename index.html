<html>

<head>
	<title>Idle Test</title>
</head>

<body>
	<small>thx dimava for his example <a
			href="https://github.com/Dimava/dimava.github.io/blob/master/idle-game-examples/cancer/index.html">Link</a></small>

	
	<div id="elStoneContainer"> Stone: <span id="elStone"></span> </div>
	<div id="elCoinsContainer"> Coins: <span id="elCoins"></span> </div>
	<div id="elWorkerContainer"> Workers: <span id="elWorkerCount"></span> </div>
	<div id="elSellerContainer"> Sellers: <span id="elSellerCount"></span> </div>
	<br>

	<button onclick="game.getStone()"> Get a stone </button>
	<button onclick="game.getCoin()"> sell a stone </button>
	<button id="btnBuyWorker"> Get a worker (<span id="elWorkerCost"></span> coins)</button>
	<button id="btnBuySeller"> Get a seller (<span id="elSellerCost"></span> coins)</button>
	<br>
	<div id="elEndGame">  </div>
	<button style="float: right;" onclick="game.clearSave()"> Reset game </button>


	<script>
		/** everything that saves goes here */
		var data = {
			tick: 0,
			stone: 0,
			coins: 0,
			sellers: 0,
			workers: 0,
		};
		/** everything that is function goes here */
		var game = {
			/** initialization goes here */
			init() {
				// using `element.onclick` is cancer, but it is simple and does work
				btnBuyWorker.onclick = () => game.getWorker();
				
			},
			/** everything that updates goes here */
			tick() {
				data.tick = data.tick + 1;
				data.stone += data.workers;
				if (data.tick.mod = 2) {
					data.stone = data.stone - (data.sellers * 2);
					data.coins = data.coins + data.sellers;
				} 

				game.updateDisplay();
			},
			/** everything that draws goes here */
			updateDisplay() {
				
				elStone.innerText = data.stone;
				elCoins.innerText = data.coins;
				elWorkerContainer.hidden = data.workers == 0 && !game.canGetWorker();
				elWorkerCost.innerText = game.getWorkerCost();
				elWorkerCount.innerText = data.workers;
				elSellerContainer.hidden = data.sellers == 0 && !game.canGetSeller();
				elSellerCost.innerText = game.getSellerCost();
				elSellerCount.innerText = data.sellers;
				elEndGame.hidden = data.workers < 2;

			},

			getStone() {
				data.stone++;
				game.updateDisplay();
			},

			getCoin() {
				if (data.stone >= 2) {
					data.stone = data.stone - 2;
					data.coins++;
				}
				game.updateDisplay();
				
			},

			getWorkerCost() {
				return data.workers + 10;
			},
			canGetWorker() {
				return data.coins >= game.getWorkerCost();
			},
			getWorker() {
				if (game.canGetWorker()) {
					data.coins -= game.getWorkerCost();
					data.workers++;
				}
				game.updateDisplay();
			},
			
			getSellerCost() {
				return data.sellers * 2 + 20);
			},
			canGetSeller() {
				return data.coins >= game.getSellerCost();
			},
			getSeller() {
				if (game.canGetSeller()) {
					data.coins -= game.getSellerCost();
					data.sellers++;
				}
				game.updateDisplay();
			},

			// theese are not perfect, but they are simple 
			save(savename = 'cancersave') {
				localStorage.setItem(savename, JSON.stringify(data));
			},
			load(savename = 'cancersave') {
				Object.assign(data, JSON.parse(localStorage.getItem(savename) || '{}'));
				game.init();
				game.updateDisplay();
			},
			clearSave(savename = 'cancersave') {
				localStorage.setItem(savename, '{}');
				location.reload();
			},
			start() {
				
				setInterval(() => game.tick(), /* 1 second */ 1e3);
				setInterval(() => game.save(), /* 10 seconds */ 10e3);
			},
		}
		game.load();
		game.start();
	</script>

	<script>


	</script>


</body>

</html>
